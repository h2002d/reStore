<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="theme-color" content="rgb(2,112,6)" />
    <title>@ViewBag.Title -Dora Market</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    <link rel="apple-touch-icon" href="~/images/logo-dora.png" sizes="192x192" />
    <link rel="shortcut icon" href="~/favicon.ico" type="image/x-icon">
    <link rel="icon" href="~/favicon.ico" type="image/x-icon">
    @Scripts.Render("~/bundles/jquery")
</head>
<body>
    @if (Request.Browser.IsMobileDevice)
    {
        <style>
            .item-div {
                padding: 0 5px 10px 5px !important;
            }
        </style>
    }

    <div class="list-inline top-menu row" style="font-family:Spirax;">
        <div class="@(Request.Browser.IsMobileDevice?"col-xs-2":"col-xs-3")" style="font-size:25px;font-family:Pacifico;" align="center" title="Dora Market">
            <a href="/">
                <img src="~/images/logo-dora.png" style="@(Request.Browser.IsMobileDevice?"width:100%":"width:45%")" />
            </a>
        </div>

        @if (Request.Cookies["Cart"] != null)
        {
            HttpCookie cookieOld = Request.Cookies["Cart"];

            var value = cookieOld.Value;
            var idList = Newtonsoft.Json.JsonConvert.DeserializeObject
            <List<LaserArt.Models.CardModel>>(value);
            ViewBag.CardCount = idList.Count;
        }
        else
        {
            ViewBag.CardCount = 0;
        }

        <div class="@(Request.Browser.IsMobileDevice?"col-xs-3":"col-xs-2") header-text" align="center">
            <span class="headerSpan" style="font-family:Verdana, Geneva, sans-serif;">Առաքում</span>
            <br />
            <span style="font-weight:600 ;font-size:15px; font-family:Verdana, Geneva, sans-serif;">+ (374)93 66-15-20,<br /> + (374)44 66-15-20</span>
            <br />
            <p>Աշխ․ ժամեր 09։00-21։00</p>

        </div>
        <div class="col-xs-3">
            <div align="center" style="margin-top: 30px;">
                <input type="text" id="searchArea" class="form-control" placeholder="Փնտրել..." />
            </div>
        </div>
        @{
            var isCategory = ViewContext.RouteData.Values["action"].ToString().ToUpper() == "CATEGORY";
            var isDiscount = ViewContext.RouteData.Values["action"].ToString().ToUpper() == "DISCOUNT";
        }
        <div class="col-xs-2">
            <div id="@(isCategory||isDiscount?"": "top-basket")" class="top-basket">
                <a class="card-class" style="text-decoration:none;">
                    <img class="cardIcon" src="~/images/cardBasketIcon.png" />
                    <u style="color: white" id="card-Count">@ViewBag.CardCount</u> @(Request.Browser.IsMobileDevice ? "" : "ապրանք")
                </a>
            </div>
        </div>
        <div class=" col-xs-2">
            <div class="socialBtn text-center">
                <a href="https://www.facebook.com/Dora-Market-Abovyan-1970658996538298/">
                    <img src="~/images/fb.png" />
                </a>
                <a href="https://www.instagram.com/d_m_a_a_d/">
                    <img src="~/images/inst.png" />
                </a>
                <a href="https://vk.com/id482844741">
                    <img src="~/images/vk.png" />
                </a>
            </div>
        </div>


    </div>

    <div style="margin: 0 40px 0 0;">

        <div class="@(Request.Browser.IsMobileDevice?"col-xs-3":"col-xs-2")" style="padding-right:0;padding-left:0; min-width:90px;">

            <ul class="vertical-nav">

                @foreach (var item in ViewBag.Categories)
            {

                    <li class="dropdownLi">

                        <a class="text-center" style="@(Request.Browser.IsMobileDevice?"font-size:12px;":"")" @(this.User.IsInRole("Administrator") ? "href=/home/editparentcategory/" + @item.Id : "")>
                            <img src="@item.ImageSource" style="height:100%; width:auto;position:absolute;top:0;left:0; padding-left: 2px;" />@item.ParentCategoryName<i class="arrow rightCategory"></i>
                        </a>

                        <ul class="sub-menu">
                            @foreach (var child in item.Childs)
                            {
                                <li style="cursor:pointer;" onclick="window.location.href='/home/Category/@child.Id'"><a class="text-center"  style="@(Request.Browser.IsMobileDevice?"font-size:12px;":"")" href="/home/Category/@child.Id">@child.CategoryName</a></li>
                            }
                        </ul>
                    </li>
                }

                @if (this.User.IsInRole("Administrator"))
            {
                    <li>@Html.ActionLink("Ավելացնել ապրանք", "CreateProduct", "Home")</li>
                    <li>@Html.ActionLink("Ավելացնել բաժին", "CreateParentCategory", "Home")</li>
                    <li>@Html.ActionLink("Ավելացնել ենթաբաժ.", "CreateCategory", "Home")</li>
                    <li>@Html.ActionLink("Պատվերներ", "Order", "Admin")</li>
                    <li>@Html.ActionLink("Առկա չեն", "OutStock", "Home")</li>
                    <li>@Html.ActionLink("Ակցիա", "Sales", "Home")</li>

                    @Html.Partial("_LoginPartial")
                }

            </ul>
        </div>

        <div class="@(Request.Browser.IsMobileDevice?"col-xs-9":"col-xs-10")" style="padding:0 !important;">
            <div class="container body-content">
                <ul class="horizontal-ul">
                    <li class="horizontal-li"><a class="horizontal-a" href="/">Գլխավոր</a></li>
                    <li class="horizontal-li"><a class="horizontal-a" href="/Home/Discount">Ակցիա</a></li>
                    <li class="horizontal-li"><a class="horizontal-a" href="/Home/Delivery">Առաքում</a></li>
                    <li class="horizontal-li"><a class="horizontal-a" href="/Home/About">Մեր մասին</a></li>
                    <li class="horizontal-li"><a class="horizontal-a" href="/Home/Contact">Կապ</a></li>
                </ul>
                <div class="container-margin">
                    @RenderBody()
                </div>
                <hr style="border-top:1px solid #000000 !important;" />
                <footer style="margin:0 0 50px 20px; font-size:10px;">


                    <div style="display:inline-block">
                        <img src="~/images/1.png" />
                    </div>
                    <div style="display:inline-block">
                        <img src="~/images/3.png" />
                    </div>
                    <div style="display:inline-block">
                        <img src="~/images/4.png" />
                    </div>
                    <div style="display:inline-block">
                        <img src="~/images/l5.png" />
                    </div>
                    <div style="display:inline-block">
                        <img src="~/images/6.png" />
                    </div>
                    <hr />
                    <p style="font-family:Verdana, Geneva, sans-serif;">
                        &copy; @DateTime.Now.Year - Dora Market Powered by <a style="color:rgb(2,112,6)" href="https://www.facebook.com/novirarm">Novir</a>
                        <br />
                        Հեռ.: <phone>+(374)93 03-03-08</phone>
                    </p>
                </footer>
            </div>
            <button onclick="topFunction()" id="myBtn" title="Go to top">^</button>


        </div>

        <div align="center" id="orderDetails">
            <p id="infoMessage"></p>
            <input type="button" class="btn btn-default" value="ОК" onclick="refreshThePage()" />
        </div>
    </div>
    <div id="basket-popup-container" class="basket-popup-container basket-all-container">
        @if (!isDiscount && !isCategory)
        {
            @Html.Action("CardPartial", "Home")
        }
    </div>

    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
    <script src="https://cloud.tinymce.com/stable/tinymce.min.js"></script>
    <script>tinymce.init({ selector: '#textarea' });</script>
    <script type="text/javascript">
        $(document).click(function (e) {
            if (!($('#basket-popup-container').has(e.target).length) && e.target.id != 'top-basket' && e.target.className!='add-basket' && !($('#top-basket').has(e.target).length)) {
                $('.basket-popup-container').hide(100);
            }

        });
        function submitReview() {
            var name = $('#name').val();
            var email = $('#email').val();
            var body = $('#body').val();

            $.ajax({
                url: "/Home/SubmitReview/",
                type: "POST",
                data: { name: name, email: email, body: body, },
                success: function (response) {
                    $('#infoMessage').text(response);
                    $('#orderDetails').show();

                },
                error: function (er) {

                    alert(er.responseText);
                }

            });
        }
        function refreshThePage() {
            closeOrderDiv();
            location.reload();
        }
        window.onscroll = function () { scrollFunction() };
        function saleDetails() {
            var selected = $('#SaleDropDown').val();
            window.location = "/Home/SalesDetails/" + selected;
        }
        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                document.getElementById("myBtn").style.display = "block";
            } else {
                document.getElementById("myBtn").style.display = "none";
            }
        }

        // When the user clicks on the button, scroll to the top of the document
        function topFunction() {
            document.body.scrollTop = 0; // For Chrome, Safari and Opera
            document.documentElement.scrollTop = 0; // For IE and Firefox
        }
        var isCompleted = 1;
        $(document).on('change','.city-select', function () {
            var amount = parseInt($('.card-amount').text());
            var delivery = parseInt($(this).find(":selected").attr('name'));
            var average = amount + delivery;
            $('.delivery-money').text(delivery);
            $('.average-amount').text(average);
        });
        $(document).on('click', '.removeCard', (function () {
            if (isCompleted == 0)
                return;
            isCompleted = 0;
            var id = $(this).attr('id');
            var itemDOM = $(this);
            var parent = itemDOM.closest('td').closest('tr').closest('.products-body');
            $.ajax({
                url: "/Home/RemoveCard/" + id,
                type: "POST",
                processData: false,
                contentType: false,
                success: function (response) {
                    //code after success
                    isCompleted = 1;
                    if (itemDOM.closest('td').closest('tr').closest('.products-body').children().length == 2) {
                        $('.btn-order-accomplished').css('display', 'none');
                    }

                      $('.basket-all-container').load('/Home/CardPartial/@ViewBag.IsCategory');
                        $('#card-Count').load("/Home/GetCount")

                        if (parseInt($('#card-Count').text()) == 0) {
                            $('body').trigger('click');
                        }
                        var amount = parseInt($('.card-amount').text());
                        var deliveryMoney = parseInt($('.city-select').find(":selected").attr('name'));
                        var cardAverage = amount + deliveryMoney;
                        $('.delivery-money').text(deliveryMoney);
                        $('.average-amount').text(cardAverage);
                        $('#top-basket').trigger('click');
                    //var amount = parseInt(parent.find('.card-amount').text());
                    //var removed = parseInt(response);
                    //var finalAmount = amount - removed;
                    //var deliveryMoney = parseInt(parent.find('.city-select').find(":selected").attr('name'));
                    //var cardAverage = finalAmount + deliveryMoney;
                    //$('.card-amount').text(finalAmount);
                    //$('.delivery-money').text(deliveryMoney);
                    //$('.average-amount').text(cardAverage);

                },
                error: function (er) {
                    isCompleted = 1;

                }

            });

        }));

        $(document).ready(function () {
            var distance = $('#table-container').offset();
            var topDistance = distance.top;

            //            if ((topDistance + 100) < scroll_pos) {
            //                $(".vertical-menu").addClass("fixed-category");
            //            }
            //            else {
            //                $(".vertical-menu").removeClass("fixed-category");
            //            }
            //        });
            $('#table-container').attr('data-offset-top', topDistance);
            //$('.body-content').css("min-height", function () {
            //    return $('.sidebar-nav').height();
            //});
            $('#searchArea').bind("enterKey", function (e) {
                window.location = "/home/Search?query=" + $(this).val().replace(/</g, "&lt;").replace(/>/g, "&gt;");;
            });
            $('#searchArea').keyup(function (e) {
                if (e.keyCode == 13) {
                    $(this).trigger("enterKey");
                }
            });

                $('#top-basket').click(function () {
                    $('.basket-popup-container').show(400);
                    });


            $('.product').click(function () {
                    window.location = "/home/product/" + $(this).attr('id');
                });
            $('.adminOrderRow').click(function () {
                    window.location = "/admin/orderdetails/?OrderId=" + $(this).parent().attr('id');
                });
            $('.orderSetStatus').click(function () {
                    var orderId = $(this).parent().parent().attr('id');
                    var status = $('input[name=orderStatus_' + orderId + ']:checked').val();
                    alert('Статус изменен');
                    window.location = "/admin/ChangeOrderStatus/?orderId=" + orderId + "&status=" + status;
                });
            $('.deleteProduct').click(function () {
                    var id = $(this).attr('id');
                $.ajax({
                        url: "/Home/RemoveProduct/" + id,
                    type: "POST",
                    processData: false,
                    contentType: false,
                    success: function (response) {
                            //code after success
                            alert(response);
                            window.location = "/Home/";

                        },
                    error: function (er) {

                            alert(er.responseText);
                        }

                    });
                });

            $(".fileUpload").click(function () {
                    var parent = $(this).parent();
                    var data = new FormData();
                    var files = $(this).parent().find(".uploadEditorImage").get(0).files;
                    if (files.length > 0) {
                        data.append("HttpPostedFileBase", files[0]);
                    $(this).parent().find('.image').val('/images/' + files[0].name)
                    }
                //.val('/images/' + files[0].name);
                $.ajax({
                        url: "/Home/FileUpload/",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                            //code after success
                            alert(response)
                    },
                    error: function (er) {

                            alert(er.responseText);
                        }

                    });
                });
            $("#PhoneNumber").keydown(function (e) {
                    // Allow: backspace, delete, tab, escape, enter and .
                    if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                        // Allow: Ctrl+A, Command+A
                        (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                        // Allow: home, end, left, right, down, up
                        (e.keyCode >= 35 && e.keyCode <= 40)) {
                        // let it happen, don't do anything
                        return;
                    }
                    // Ensure that it is a number and stop the keypress
                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });
            $(".SalefileUpload").click(function () {
                    var parent = $(this).parent();
                    var data = new FormData();
                    var files = $(this).parent().find(".uploadEditorImage").get(0).files;
                    if (files.length > 0) {
                        data.append("HttpPostedFileBase", files[0]);
                    $(this).parent().find('.image').val('/images/Carousel/' + files[0].name)
                    }
                //.val('/images/' + files[0].name);
                $.ajax({
                        url: "/Home/FileUploadCarousel/",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                            //code after success
                            alert(response)
                    },
                    error: function (er) {

                            alert(er.responseText);
                        }

                    });
                });
        });
        function goToDetails() {


            window.location = "/home/orderDetails/" + $('#listInt').val();
        }
        function orderBtnClick() {
            var id = $('.city-select').find(":selected").val();
            window.location = "/home/orderDetails/" + id;
        }
        $('.input-number-increment').click(function () {
            var quantity = $(this).closest('.input-group-button').closest('.input-number-group').children('.cardQuantity');
            var Isdecimal = quantity.attr('name');
            var val = parseFloat(quantity.val());
            var step = 1;
            var tofixed = 0;
            if (Isdecimal == '1')
            {
                step = 0.1;
                tofixed = 1;
            }
            var value = val + step;

            quantity.val(value.toFixed(tofixed));
        });

        $('.input-number-decrement').click(function () {
            var quantity = $(this).closest('.input-group-button').closest('.input-number-group').children('.cardQuantity');
            var Isdecimal = quantity.attr('name');
            var val = parseFloat(quantity.val());
            var step = 1;
            var tofixed = 0;
            if (Isdecimal == '1') {
                step = 0.1;
                tofixed = 1;
            }
            if (val <= step) {
                quantity.val(step);
            }
            else {
                var value = val - step
                quantity.val(value.toFixed(tofixed));
            }
        })

        function orderBtnClickItem(itemId, specId) {
            var quantity = 1;

            $.ajax({
                url: "/Home/AddToCard?productId=" + itemId + "&quantity=" + quantity,
                type: "GET",
                processData: false,
                contentType: false,
                success: function (response) {
                    window.location = "/home/card";

                },
                error: function (er) {

                    alert(er.responseText);
                }

            });
        }
       $(document).ready(function () {
            $(".iconImg").click(function (event) {

                $('#generalImg').attr('src', $(event.target).parent().find('.imageSrc').val());
            });
            $('.add-basket').click(function () {
                var itemId = $(this).attr('id');
                var quantity = $(this).closest('.properties-div').children('.item-sub').children('.input-number-group').children('.cardQuantity').val();

                if (quantity == "" || quantity == "0") {
                    $('#cardQuantityRequired').html("Укажите количество товара.");
                    $('#cardQuantity').focus();
                    return;
                }
                var isDecimal = $(this).attr('name');
                    if (isDecimal=='0'&&quantity != parseInt(quantity, 10)) {
                        alert("Քանակը սխալ է.");
                        var roundedQuantity = Math.round(quantity);
                        if (roundedQuantity == 0)
                            roundedQuantity = 1;
                        $('#cardQuantity').val(roundedQuantity);

                        $('#cardQuantity').focus();
                        return;
                    }
                
                $.ajax({
                    url: "/Home/AddToCard?productId=" + itemId + "&quantity=" + quantity,
                    type: "GET",
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        //code after success

                        $('.basket-all-container').load('/Home/CardPartial/@ViewBag.IsCategory');
                        $('#card-Count').load("/Home/GetCount")

                        var amount = parseInt($('.card-amount').text());
                        var deliveryMoney = parseInt($('.city-select').find(":selected").attr('name'));
                        var cardAverage = amount + deliveryMoney;
                        $('.delivery-money').text(deliveryMoney);
                        $('.average-amount').text(cardAverage);
                        $('#top-basket').trigger('click');
                    },
                    error: function (er) {

                        alert(er.responseText);
                    }

                });
            });
           
            var amount = parseInt($('.card-amount').text());
            var deliveryMoney = parseInt($('.city-select').find(":selected").attr('name'));
            var cardAverage = amount + deliveryMoney;
            $('.delivery-money').text(deliveryMoney);
            $('.average-amount').text(cardAverage);

        });
        function closeOrderDiv() {
            $("#orderDetails").hide();
        }
        function parentEdit(id) {
            window.location.href = "/Home/EditParentCategory/" + id;
        }
    </script>


</body>
</html>
